<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sponser Bestellformular EHCB</title>
  <link rel="icon" href="EHCB Sponser icon.png">
  <style>
    body { font-family: Arial, sans-serif; background: #fff; color: #222; margin: 0; padding: 0; min-height: 100vh; }
    .header { display: flex; flex-direction: column; align-items: center; background: #fff; border-bottom: 2.5px solid #e10c18; padding: 1.2rem 1rem 1rem 1rem; gap: 1rem; margin-bottom: 2rem; }
    .header img { max-height: 130px; margin-bottom: 0.3rem; }
    .header-title { font-size: 2.2rem; font-weight: bold; color: #e10c18; letter-spacing: 0.05em; text-align: center; }
    .bestellformular { max-width: 750px; margin: 0 auto; background: #f7f8fb; border-radius: 16px; padding: 2rem 1rem; box-shadow: 0 0 12px 2px #f3f3f3; }
    .form-row { margin-bottom: 1.3rem; display: flex; flex-direction: column; gap: 0.4rem; }
    label { font-weight: 600; }
    input, select, textarea { padding: 0.5rem; font-size: 1.09rem; border-radius: 7px; border: 1px solid #c3c3c3; outline: none; }
    .produktliste { margin-bottom: 1.5rem; }
    .produkt { background: #fff; border-radius: 10px; box-shadow: 0 0 3px #e0e0e0; margin-bottom: 1.5rem; padding: 1.3rem 1.3rem 1.1rem 1.3rem; display: flex; flex-direction: column; gap: 0.7rem; }
    .produkt-head { display: flex; align-items: flex-start; gap: 1.2rem; margin-bottom: 0.2rem; }
    .produkt-bild { width: 68px; height: 68px; object-fit: contain; background: #f3f3f3; border-radius: 8px; border: 1px solid #e5e5e5; margin-right: 1.1rem; }
    .produkt-title { font-size: 1.13rem; font-weight: bold; color: #e10c18; margin-bottom: 2px; }
    .produkt-beschr { font-size: 0.99rem; color: #444; margin-bottom: 0.2rem; }
    .geschmack-block { margin-top: 0.7rem; }
    .geschmack-table { width: 100%; border-collapse: collapse; margin-top: 0.2rem;}
    .geschmack-table th, .geschmack-table td { padding: 0.37rem 0.7rem 0.37rem 0; font-size: 1.01rem; text-align: left;}
    .geschmack-table th { font-weight: 600;}
    .menge-dropdown { width: 62px; }
    .submit-btn { margin-top: 2.1rem; background: #e10c18; color: #fff; font-size: 1.2rem; font-weight: bold; padding: 0.83rem 2.5rem; border-radius: 9px; border: none; cursor: pointer; letter-spacing: 0.04em; box-shadow: 0 2px 10px #eee; transition: background 0.2s; }
    .submit-btn:hover { background: #bf0912; }
    .info-text { margin-top: 1.2rem; color: #555; font-size: 1rem; }
    .admin-link { display: flex; justify-content: flex-end; margin-bottom: 0.7rem; }
    .admin-btn { background: #e10c18; color: #fff; font-weight: bold; padding: 0.5rem 1.3rem; border-radius: 6px; border: none; cursor: pointer; font-size: 1rem; margin-left: 0.7rem; letter-spacing: 0.02em; transition: background 0.2s; }
    .admin-btn:hover { background: #a60b12; }
    .admin-panel { max-width: 900px; margin: 0 auto 2rem auto; background: #fff6f7; border-radius: 14px; box-shadow: 0 0 10px #eee; padding: 2rem 1.1rem 2.1rem 1.1rem; }
    .admin-title { color: #e10c18; font-size: 1.45rem; font-weight: bold; margin-bottom: 0.8rem; text-align: center; }
    .admin-close-btn { float: right; font-size: 1.1rem; background: #f0f0f0; border-radius: 8px; border: none; color: #888; cursor: pointer; margin-bottom: 0.7rem; padding: 0.19rem 0.85rem; }
    .admin-prod-table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; }
    .admin-prod-table th, .admin-prod-table td { padding: 0.45rem 0.6rem; border: 1px solid #ddd; font-size: 0.97rem; }
    .admin-prod-table th { background: #e10c18; color: #fff; font-weight: 600; }
    .admin-prod-table input, .admin-prod-table textarea { width: 98%; font-size: 0.98rem; border-radius: 5px; border: 1px solid #ccc; padding: 0.24rem 0.4rem; margin: 0.1rem 0; background: #fff; }
    .admin-btn-row { display: flex; gap: 1.1rem; margin-bottom: 0.7rem; margin-top: 1.3rem; justify-content: flex-end; }
    .admin-info { color: #888; font-size: 0.96rem; margin-bottom: 1rem; text-align: right; }
    .order-table { width: 100%; border-collapse: collapse; margin-top: 1.6rem; }
    .order-table th, .order-table td { border: 1px solid #ddd; padding: 0.36rem 0.6rem; font-size: 0.99rem; }
    .order-table th { background: #e10c18; color: #fff; font-weight: 600; text-align: left; }
    .order-table tr:nth-child(even) { background: #f6f6f6; }
    .export-btn { margin-top: 1.2rem; background: #e10c18; color: #fff; border: none; border-radius: 7px; padding: 0.56rem 1.4rem; font-size: 1.07rem; font-weight: 600; cursor: pointer; margin-right: 1.2rem; }
    .export-btn:last-child { margin-right: 0; }
    .order-table thead th { position: sticky; top: 0; z-index: 1; }
    .reset-btn { margin-left: 1.1rem; color: #e10c18; background: #fff; border: 1.5px solid #e10c18; padding: 0.55rem 1.1rem; border-radius: 7px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background 0.2s, color 0.2s; }
    .reset-btn:hover { background: #e10c18; color: #fff; }
    .modal-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.18); z-index: 1001; display: flex; align-items: center; justify-content: center; }
    .modal { background: #fff; border-radius: 12px; box-shadow: 0 4px 24px #aaa; padding: 2.2rem 1.2rem 1.7rem 1.2rem; max-width: 430px; min-width: 260px; text-align: left; }
    .modal h3 { color: #e10c18; font-size: 1.25rem; margin-top: 0; }
    .modal-btn-row { margin-top: 1.5rem; display: flex; gap: 1.5rem; justify-content: flex-end; }
    .modal-btn { background: #e10c18; color: #fff; font-weight: bold; padding: 0.55rem 1.8rem; border-radius: 7px; border: none; font-size: 1rem; cursor: pointer; }
    .modal-btn.cancel { background: #fff; color: #e10c18; border: 1.5px solid #e10c18; }
    .modal-btn.cancel:hover { background: #e10c18; color: #fff; }
    .modal-btn.confirm:hover { background: #a60b12; }
    @media (max-width: 900px) { .admin-panel, .bestellformular { max-width: 98vw; } }
    @media (max-width: 700px) { .header-title { font-size: 1.15rem; } .header img { max-height: 53px; } .produkt-bild { width: 47px; height: 47px; } .produkt { padding: 0.9rem 0.7rem; } .admin-prod-table th, .admin-prod-table td, .order-table th, .order-table td { font-size: 0.95rem; padding: 0.2rem 0.3rem; } .admin-panel, .bestellformular { padding: 0.7rem 0.1rem 1.1rem 0.1rem; } }
  </style>
</head>
<body>
  <div class="header">
    <img src="EHCB Sponser icon.png" alt="EHCB Sponser" />
    <span class="header-title">Sponser Bestellformular</span>
  </div>
  <div class="admin-link">
    <button class="admin-btn" id="adminLoginBtn">Admin-Login</button>
  </div>
  <div id="adminPanel" style="display:none;"></div>
  <div class="bestellformular" id="bestellformularWrap">
    <form id="orderForm" autocomplete="off">
      <div class="form-row">
        <label for="spielerName">Name*</label>
        <input type="text" id="spielerName" name="spielerName" required autocomplete="off" />
      </div>
      <div class="form-row">
        <label for="spielerEmail">E-Mail*</label>
        <input type="email" id="spielerEmail" name="spielerEmail" required autocomplete="off" />
      </div>
      <div class="produktliste" id="produktListe"></div>
      <button class="submit-btn" type="submit">Bestellung absenden</button>
    </form>
    <div class="info-text">
      <b>Zahlung:</b> Bar oder TWINT bei Erhalt der Ware.<br>
      <b>Bestellbestätigung:</b> Eine Bestellübersicht erscheint vor Absenden.<br>
    </div>
  </div>
  <!-- Admin Login Modal -->
  <div id="adminModal" style="display:none; position:fixed; top:0;left:0;width:100vw;height:100vh;z-index:999; background:rgba(0,0,0,0.18);align-items:center;justify-content:center;">
    <div style="background:#fff; padding:2rem 1.2rem; border-radius:14px; box-shadow:0 0 10px #ccc; max-width:340px; margin:auto; text-align:center;">
      <div style="font-size:1.22rem; font-weight:600; color:#e10c18; margin-bottom:1.2rem;">Admin-Login</div>
      <input type="password" id="adminPw" placeholder="Admin Passwort" style="width:80%;padding:0.6rem 0.8rem; font-size:1.05rem; border-radius:8px;border:1px solid #bbb;" autocomplete="off" />
      <br>
      <button class="admin-btn" style="margin-top:1.2rem;" id="doAdminLogin">Login</button>
      <button class="reset-btn" style="margin-top:1.2rem;" id="cancelAdminLogin">Abbrechen</button>
      <div id="adminPwError" style="color:#e10c18; margin-top:0.7rem;font-size:0.99rem;display:none;">Falsches Passwort!</div>
    </div>
  </div>
  <!-- Bestellübersicht Modal -->
  <div id="reviewModal" style="display:none"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>// Lokaler Storage Key für Produkte
const PRODUCTS_KEY = 'ehcb_sponser_products_v2';

// Standard-Produkte und Varianten (vollständig, wie im Jotform)
const DEFAULT_PRODUCTS = [
  {
    name: "Recovery Shake - 900g",
    preis: 21.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40016_recovery_shake_900g.png",
    beschreibung: "Inhalt 900g - PRO RECOVERY von Sponser® ist ein Protein-Kohlenhydrat Regenerationsshake für den anspruchsvollen Ausdauer- und Kraftsportler. Hochwertige Protein-Kombination, optimale Regeneration nach dem Sport.",
    varianten: ["Vanilla", "Chocolate", "Banana"]
  },
  {
    name: "MULTI PROTEIN (New) - 425g",
    preis: 21.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40046_multi_protein_425g.png",
    beschreibung: "Mehrkomponenten-Eiweiss (Casein, Whey, Eialbumin), vielseitig einsetzbar, ideal nach dem Training und zur Ergänzung der Tagesernährung.",
    varianten: ["Chocolate-Pistachio", "Vanilla", "Banana", "Chocolate", "Strawberry"]
  },
  {
    name: "Whey Isolate 94 - 425g",
    preis: 21.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40044_whey_isolate_94_425g.png",
    beschreibung: "Inhalt 425g - Reines Molkenproteinisolat, hoher Proteingehalt, sehr tiefer Fett- und Kohlenhydratanteil, optimale biologische Wertigkeit.",
    varianten: ["Vanilla", "Chocolate", "Strawberry", "Mango", "Caffe-Latte", "Joghurt-Lemon"]
  },
  {
    name: "Whey Isolate 94 - 850g",
    preis: 38.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40044_whey_isolate_94_850g.png",
    beschreibung: "Inhalt 850g - Reines Molkenproteinisolat, hoher Proteingehalt, sehr tiefer Fett- und Kohlenhydratanteil, optimale biologische Wertigkeit.",
    varianten: ["Vanilla", "Chocolate", "Banana", "Neutral"]
  },
  {
    name: "Whey Isolate 94 - 1500g",
    preis: 60.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40044_whey_isolate_94_1500g.png",
    beschreibung: "Inhalt 1500g - Reines Molkenproteinisolat, hoher Proteingehalt, sehr tiefer Fett- und Kohlenhydratanteil, optimale biologische Wertigkeit.",
    varianten: ["Vanilla", "Chocolate", "Strawberry", "Banana", "Neutral"]
  },
  {
    name: "Protein 50 - 1 Box (25×50g) - Chocolate",
    preis: 40.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/47011_protein_50_chocolate.png",
    beschreibung: "Multiproteinriegel mit 50% Eiweissanteil, geeignet für Aufbau und Erhalt der Muskelmasse.",
    varianten: ["Chocolate"]
  },
  {
    name: "Crunchy Protein Bar - 1 Box (12×50g)",
    preis: 24.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/47042_crunchy_protein_bar_box.png",
    beschreibung: "Knuspriger Proteinriegel – proteinreich, wenig Zucker, schmackhaft.",
    varianten: ["Pinat-Caramel", "Rasperry"]
  },
  {
    name: "HIGH ENERGY BAR - 1 Box (30×45g)",
    preis: 45.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/48012_high_energy_bar_box.png",
    beschreibung: "Getreideriegel liefert schnelle und langanhaltende Energie.",
    varianten: ["Banana", "Berry", "Apricot-Vanilla", "Salty-Nuts"]
  },
  {
    name: "ENERGY BALLS - 1 Box (18 X 45g)",
    preis: 31.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/48021_energy_balls_box.png",
    beschreibung: "Fruchtige und energiereiche Bällchen, ideal für unterwegs oder im Training.",
    varianten: ["Blueberry", "Mango", "Salted-Caramel"]
  },
  {
    name: "Low Carb Protein Bar - 1 Box (18 x 35g)",
    preis: 25.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/47027_low_carb_protein_bar_box.png",
    beschreibung: "Eiweissriegel mit geringem Kohlenhydratgehalt, ideal als Snack oder nach dem Training.",
    varianten: ["Chocolate", "Vanilla"]
  },
  {
    name: "Electrolytes Tabs (1 Röhrli/10 Stück)",
    preis: 8.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40050_electrolytes_tabs.png",
    beschreibung: "Brausetabletten für ein kalorienarmes Getränk, ideal zur Elektrolytversorgung.",
    varianten: ["Lemon", "Cola", "Red Orange"]
  },
  {
    name: "Competition (neutral) - Dose 1000g",
    preis: 28.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40042_competition_1000g.png",
    beschreibung: "Säurearmes Sportgetränk ohne künstliche Süssstoffe, Farbstoffe und Aromastoffe.",
    varianten: ["neutral"]
  },
  {
    name: "Competition (red orange) - Dose 1000g",
    preis: 28.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40042_competition_1000g.png",
    beschreibung: "Sportgetränk mit Geschmack red orange.",
    varianten: ["red orange"]
  },
  {
    name: "ISOTONIC - Dose 1000g",
    preis: 24.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40044_isotonic_1000g.png",
    beschreibung: "Hypotonisches Sportgetränk für optimale Flüssigkeitszufuhr.",
    varianten: ["Orange", "Lemon", "Red Fruits", "Ice Tea"]
  },
  {
    name: "Carbo Loader - Dose 1000g",
    preis: 30.00,
    bild: "https://www.sponser.ch/media/catalog/product/cache/2f698c8f1e9a9e440e52b438828b11a9/4/0/40060_carbo_loader_1000g.png",
    beschreibung: "Kohlenhydrat-Elektrolytgetränk für das gezielte Carboloading.",
    varianten: ["Fruit-Mix"]
  }
];

// Produkte initialisieren
let products = JSON.parse(localStorage.getItem(PRODUCTS_KEY)) || DEFAULT_PRODUCTS;

// Hilfsfunktion zum Speichern
function saveProducts() {
  localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
}

// Produkte auf der Seite anzeigen
function renderProdukte() {
  const produktListe = document.getElementById('produktListe');
  produktListe.innerHTML = '';
  products.forEach((produkt, idx) => {
    let html = `
      <div class="produkt">
        <div class="produkt-head">
          <img class="produkt-bild" src="${produkt.bild}" alt="${produkt.name}">
          <div>
            <div class="produkt-title">${produkt.name} &ndash; CHF ${produkt.preis.toFixed(2)}</div>
            <div class="produkt-beschr">${produkt.beschreibung || ""}</div>
          </div>
        </div>
        <div class="geschmack-block">
          <table class="geschmack-table">
            <thead><tr><th>Geschmack</th><th>Menge</th></tr></thead>
            <tbody>
    `;
    produkt.varianten.forEach((geschmack, gidx) => {
      const feldId = `menge_${idx}_${gidx}`;
      html += `
        <tr>
          <td>${geschmack}</td>
          <td>
            <select id="${feldId}" class="menge-dropdown" name="${produkt.name}|${geschmack}">
              <option value="0">–</option>
              ${[...Array(10)].map((_,i) => `<option value="${i+1}">${i+1}</option>`).join("")}
            </select>
          </td>
        </tr>
      `;
    });
    html += `</tbody></table></div></div>`;
    produktListe.innerHTML += html;
  });
}// --- Review Modal anzeigen ---
function showReviewModal(bestellung, name, email) {
  let summe = 0;
  let html = `
    <div class="modal-bg" style="display:flex;">
      <div class="modal">
        <h3>Bestellübersicht</h3>
        <ul style="padding-left:1.1em;">
  `;
  bestellung.forEach(item => {
    html += `<li>${item.menge} × ${item.produkt}, Geschmack: ${item.geschmack} (CHF ${(item.preis*item.menge).toFixed(2)})</li>`;
    summe += item.preis * item.menge;
  });
  html += `</ul>
    <b>Gesamtsumme: CHF ${summe.toFixed(2)}</b>
    <br><br>
    <div style="font-size:0.98rem;color:#888;margin-bottom:0.8em;">Name: <b>${name}</b> | E-Mail: <b>${email}</b></div>
    <div class="modal-btn-row">
      <button class="modal-btn cancel" id="reviewCancelBtn">Zurück</button>
      <button class="modal-btn confirm" id="reviewConfirmBtn">Bestellung absenden</button>
    </div>
  </div></div>`;
  const reviewModal = document.getElementById('reviewModal');
  reviewModal.innerHTML = html;
  reviewModal.style.display = "block";
  document.getElementById('reviewCancelBtn').onclick = () => reviewModal.style.display = "none";
  document.getElementById('reviewConfirmBtn').onclick = () => {
    reviewModal.style.display = "none";
    finalizeOrder(bestellung, name, email);
  };
}

// --- Bestellung absenden (zeigt erst Review-Modal) ---
document.getElementById('orderForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const name = document.getElementById('spielerName').value.trim();
  const email = document.getElementById('spielerEmail').value.trim();
  if (!name || !email) {
    alert("Bitte Name und E-Mail angeben!");
    return;
  }
  let bestellung = [];
  products.forEach((produkt, pIdx) => {
    produkt.varianten.forEach((geschmack, gIdx) => {
      const feldId = `menge_${pIdx}_${gIdx}`;
      const menge = parseInt(document.getElementById(feldId).value, 10) || 0;
      if (menge > 0) {
        bestellung.push({
          produkt: produkt.name,
          geschmack,
          preis: produkt.preis,
          menge,
        });
      }
    });
  });
  if (bestellung.length === 0) {
    alert("Bitte mindestens ein Produkt auswählen!");
    return;
  }
  showReviewModal(bestellung, name, email);
});

// --- Bestellung wirklich speichern & Seite anzeigen ---
function finalizeOrder(bestellung, name, email) {
  const timestamp = new Date().toISOString();
  const ORDERS_KEY = 'ehcb_sponser_orders_v5';
  let bestellungen = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
  bestellungen.push({
    name, email, items: bestellung, timestamp
  });
  localStorage.setItem(ORDERS_KEY, JSON.stringify(bestellungen));
  // Übersicht anzeigen
  let html = `<h2>Bestellung von ${name}</h2>
  <ul>`;
  let summe = 0;
  bestellung.forEach(item => {
    html += `<li>${item.menge} × ${item.produkt}, Geschmack: ${item.geschmack} (CHF ${(item.preis*item.menge).toFixed(2)})</li>`;
    summe += item.preis * item.menge;
  });
  html += `</ul><b>Gesamtsumme: CHF ${summe.toFixed(2)}</b>
  <p><b>Du erhältst die Ware und zahlst bar oder mit TWINT bei Übergabe.</b></p>`;
  document.querySelector('.bestellformular').innerHTML = html;
}

// --- Admin-Login-Dialog ---
const adminLoginBtn = document.getElementById('adminLoginBtn');
const adminModal = document.getElementById('adminModal');
const doAdminLogin = document.getElementById('doAdminLogin');
const cancelAdminLogin = document.getElementById('cancelAdminLogin');
const adminPwError = document.getElementById('adminPwError');
const ADMIN_PW = "ehcbadmin";

adminLoginBtn.onclick = () => {
  adminModal.style.display = 'flex';
  document.getElementById('adminPw').value = '';
  adminPwError.style.display = 'none';
};

cancelAdminLogin.onclick = () => {
  adminModal.style.display = 'none';
};

doAdminLogin.onclick = () => {
  const pw = document.getElementById('adminPw').value;
  if (pw === ADMIN_PW) {
    adminModal.style.display = 'none';
    openAdminPanel();
  } else {
    adminPwError.style.display = 'block';
  }
};

function openAdminPanel() {
  let panel = document.getElementById('adminPanel');
  panel.style.display = '';
  document.getElementById('bestellformularWrap').style.display = 'none';
  renderAdminPanel();
}

function closeAdminPanel() {
  document.getElementById('adminPanel').style.display = 'none';
  document.getElementById('bestellformularWrap').style.display = '';
}// --- ADMIN-PRODUKTVERWALTUNG ---
function renderAdminPanel() {
  let panel = document.getElementById('adminPanel');
  let html = `
    <button class="admin-close-btn" onclick="closeAdminPanel()">× Schließen</button>
    <div class="admin-title">Admin-Bereich: Produkte und Bestellungen</div>
    <div class="admin-info">Produkte direkt bearbeiten, löschen oder hinzufügen. Änderungen werden sofort gespeichert.</div>
    <table class="admin-prod-table" id="adminProdTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Preis</th>
          <th>Bild-URL</th>
          <th>Beschreibung</th>
          <th>Varianten (mit Komma trennen)</th>
          <th>Löschen</th>
        </tr>
      </thead>
      <tbody id="adminProdTableBody">
      </tbody>
    </table>
    <button class="admin-btn" onclick="addAdminProductRow()">+ Neues Produkt hinzufügen</button>
    <hr style="margin:2.1rem 0 1.3rem 0;">
    <div class="admin-title" style="font-size:1.07rem;color:#444;">Bestellungen (letzte 7 Tage):</div>
    <div class="admin-btn-row">
      <button class="export-btn" onclick="exportOrdersCSV()">Export als Excel</button>
      <button class="export-btn" onclick="exportOrdersPDF()">Export als PDF</button>
      <button class="reset-btn" onclick="clearOrders()">Alle Bestellungen löschen</button>
    </div>
    <div id="adminOrderWrap"></div>
  `;
  panel.innerHTML = html;
  renderAdminProducts();
  renderAdminOrders();
}

// --- ADMIN: PRODUKTBEARBEITUNG ---
function renderAdminProducts() {
  const tbody = document.getElementById('adminProdTableBody');
  tbody.innerHTML = '';
  products.forEach((produkt, idx) => {
    let row = document.createElement('tr');
    row.innerHTML = `
      <td><input value="${produkt.name}" onchange="adminEditProduct(${idx},'name',this.value)" /></td>
      <td><input type="number" min="0" step="0.01" value="${produkt.preis}" onchange="adminEditProduct(${idx},'preis',parseFloat(this.value))" /></td>
      <td><input value="${produkt.bild}" onchange="adminEditProduct(${idx},'bild',this.value)" /></td>
      <td><textarea onchange="adminEditProduct(${idx},'beschreibung',this.value)">${produkt.beschreibung||""}</textarea></td>
      <td><input value="${produkt.varianten.join(', ')}" onchange="adminEditProduct(${idx},'varianten',this.value)" /></td>
      <td><button class="reset-btn" onclick="adminDeleteProduct(${idx})">Löschen</button></td>
    `;
    tbody.appendChild(row);
  });
}

// Produktfeld bearbeiten
window.adminEditProduct = function(idx, feld, val) {
  if (feld === "varianten") {
    products[idx][feld] = val.split(',').map(s => s.trim()).filter(Boolean);
  } else {
    products[idx][feld] = val;
  }
  saveProducts();
  renderProdukte();
  renderAdminProducts();
};

// Produkt löschen
window.adminDeleteProduct = function(idx) {
  if (confirm("Produkt wirklich löschen?")) {
    products.splice(idx,1);
    saveProducts();
    renderProdukte();
    renderAdminProducts();
  }
};

// Neues Produkt hinzufügen
window.addAdminProductRow = function() {
  products.push({
    name: "", preis: 0, bild: "", beschreibung: "", varianten: []
  });
  saveProducts();
  renderProdukte();
  renderAdminProducts();
};

// --- Bestellungen der letzten 7 Tage anzeigen & Export ---
function renderAdminOrders() {
  let wrap = document.getElementById('adminOrderWrap');
  const ORDERS_KEY = 'ehcb_sponser_orders_v5';
  let bestellungen = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
  const now = Date.now();
  const orders7d = bestellungen.filter(o => now - new Date(o.timestamp).getTime() < 7*24*60*60*1000);
  if (orders7d.length === 0) {
    wrap.innerHTML = `<div style="color:#888; margin:1rem 0;">Keine Bestellungen in den letzten 7 Tagen.</div>`;
    return;
  }
  let html = `<table class="order-table"><thead>
    <tr>
      <th>Name</th><th>E-Mail</th><th>Datum</th>
      <th>Produkt</th><th>Geschmack</th>
      <th>Menge</th><th>Preis/Einheit</th>
    </tr></thead><tbody>`;
  orders7d.forEach(o => {
    o.items.forEach(item => {
      html += `<tr>
        <td>${o.name}</td>
        <td>${o.email}</td>
        <td>${(new Date(o.timestamp)).toLocaleDateString()}</td>
        <td>${item.produkt}</td>
        <td>${item.geschmack}</td>
        <td>${item.menge}</td>
        <td>${item.preis.toFixed(2)}</td>
      </tr>`;
    });
  });
  html += `</tbody></table>`;
  wrap.innerHTML = html;
}

// CSV/Excel-Export
window.exportOrdersCSV = function() {
  const ORDERS_KEY = 'ehcb_sponser_orders_v5';
  let bestellungen = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
  const now = Date.now();
  const orders7d = bestellungen.filter(o => now - new Date(o.timestamp).getTime() < 7*24*60*60*1000);
  let csv = 'Name;E-Mail;Datum;Produkt;Geschmack;Menge;Preis/Einheit\n';
  orders7d.forEach(o => {
    o.items.forEach(item => {
      csv += `"${o.name}";"${o.email}";"${(new Date(o.timestamp)).toLocaleDateString()}";"${item.produkt}";"${item.geschmack}";${item.menge};${item.preis.toFixed(2)}\n`;
    });
  });
  const blob = new Blob([csv], {type: 'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'bestellungen_ehcb_sponser.csv';
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
};

// PDF-Export
window.exportOrdersPDF = function() {
  const { jsPDF } = window.jspdf;
  const ORDERS_KEY = 'ehcb_sponser_orders_v5';
  let bestellungen = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
  const now = Date.now();
  const orders7d = bestellungen.filter(o => now - new Date(o.timestamp).getTime() < 7*24*60*60*1000);
  const doc = new jsPDF({orientation:'landscape'});
  const columns = ['Name','E-Mail','Datum','Produkt','Geschmack','Menge','Preis/Einheit'];
  let rows = [];
  orders7d.forEach(o => {
    o.items.forEach(item => {
      rows.push([o.name, o.email, (new Date(o.timestamp)).toLocaleDateString(), item.produkt, item.geschmack, item.menge, item.preis.toFixed(2)]);
    });
  });
  doc.setFontSize(11);
  doc.text('Bestellungen EHCB Sponser (letzte 7 Tage)', 12, 10);
  let startY = 16;
  let colWidths = [34,44,20,50,40,18,27];
  columns.forEach((col, i) => {
    doc.setFont(undefined, 'bold');
    doc.text(col, 10+colWidths.slice(0,i).reduce((a,b)=>a+b,0), startY);
    doc.setFont(undefined, 'normal');
  });
  rows.forEach((row, r) => {
    row.forEach((cell, i) => {
      doc.text(String(cell), 10+colWidths.slice(0,i).reduce((a,b)=>a+b,0), startY+6+r*7);
    });
  });
  doc.save('bestellungen_ehcb_sponser.pdf');
};

window.clearOrders = function() {
  if (confirm('Alle Bestellungen der letzten 7 Tage unwiderruflich löschen?')) {
    const ORDERS_KEY = 'ehcb_sponser_orders_v5';
    let bestellungen = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
    const now = Date.now();
    bestellungen = bestellungen.filter(o => now - new Date(o.timestamp).getTime() >= 7*24*60*60*1000);
    localStorage.setItem(ORDERS_KEY, JSON.stringify(bestellungen));
    renderAdminOrders();
  }
};

// Seite initialisieren
renderProdukte();

  </script>
</body>
</html>